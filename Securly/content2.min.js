///////////////////////////////
// Google Maps Content File  //
///////////////////////////////

// This runs on google maps on its load. It's a bit weird... Why would Big Brother want to know our location?



// Big Brother is watching.



////// Begin Code //////

// Connect to Big Brother
var port = chrome.runtime.connect({
    name: "gmaps"
}),

// Fetches some info about where in the world you are
prevUrl = document.location.href,
prevTitle = document.title.toString(),
title = document.querySelector("title"),
// MutationObserver for location changes on map
observer = new MutationObserver(function(e) {
    e.some(function(e) {
        var t = e.target.textContent.toString();
        if ((t = (t = t.replace(/^\([0-9]{0,}\)\s/, "")).replace(/ +/g, " ")) != prevTitle) return prevTitle = t, fetchURL(), !0
    })
});

// Sends the google maps url?!? to Big Brother Securly
function sendData(e) {
    e != prevUrl && (prevUrl = document.location.href, port.postMessage({
        action: "MapsURL",
        url: e
    }))
}

// I don't understand why it needs a delay, but this literally just sends the url.
async function fetchURL() {
    await sleep(2e3), sendData(document.location.href)
}

// Just a delay function
function sleep(e) {
    return new Promise(t => setTimeout(t, e))
}

// Observes changes in the google maps page title
observer.observe(title, {
    subtree: !1,
    characterData: !0,
    childList: !0
});